<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <link rel="shortcut icon"  type="image/x-icon" href="/images/favicon.ico">
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">

  <title>Ehcache 3.0 Documentation</title>

  <meta name="description" content="Java's most widely used cache.">

  <link rel="canonical" href="http://www.ehcache.org/documentation/3.0/usermanaged.html">
  <link rel="alternate" type="application/rss+xml" title="Ehcache" href="http://www.ehcache.org/feed.xml" />



  <!-- Fonts -->
  <link href='http://fonts.googleapis.com/css?family=Lato:300,400,300italic,400italic' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>

  <!-- Global CSS -->

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.5/spacelab/bootstrap.min.css">


<!--
  <link rel="stylesheet" href="/plugins/highlight/styles/idea.css">
  <script src="/plugins/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
-->

  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/prettify.css"></script>

  <link rel="stylesheet" href="/css/main.css">

<!--
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
  <script>document.addEventListener('DOMContentLoaded', prettyPrint)</script>
-->

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

</head>


  <body>

    

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="site-title" href="/"><img src="/images/ehcache.png"/></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li id="ehc_mnu_about"><a href="/about/"><i class="fa fa-info-circle"></i> About</a></li>
            <li id="ehc_mnu_docs"><a href="/documentation/"><i class="fa fa-book"></i> Docs</a></li>
            <li id="ehc_mnu_download"><a href="/downloads/"><i class="fa fa-download"></i> Download</a></li>
            <li id="ehc_mnu_community" class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class="fa fa-users"></i> Community <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li class="dropdown-header">We Love Contributors</li>
                <li><a href="/community/"><i class="fa fa-code"></i> Contributing</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Forums</li>
                <li><a href="https://groups.google.com/forum/#!forum/ehcache-users" target="_blank"><i class="fa fa-commenting"></i> Users' Forum</a></li>
                <li><a href="https://groups.google.com/forum/#!forum/ehcache-dev" target="_blank"><i class="fa fa-commenting"></i> Developers' Forum</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Source Code</li>
                <li><a href="https://github.com/ehcache/ehcache3"><i class="fa fa-github"></i> GitHub  (Ehcache 3)</a></li>
                <li><a href="http://svn.terracotta.org/svn/ehcache/trunk"><i class="fa fa-code-fork"></i> SVN  (Ehcache 2)</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Bug Tracking</li>
                <li><a href="https://github.com/ehcache/ehcache3/issues"><i class="fa fa-bug"></i> GitHub  (Ehcache 3)</a></li>
                <li><a href="https://jira.terracotta.org/jira/browse/EHC"><i class="fa fa-bug"></i> Jira  (Ehcache 2)</a></li>
              </ul>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li id="ehc_mnu_events"><a href="/events"><i class="fa fa-calendar"></i> News & Events</a></li>
            <li><a href="http://blog.terracotta.org"><i class="fa fa-rss-square"></i>  Blog</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

<br/>
<br/>
<br/>


    <div class="container-fluid">
      <div id="contentTitle">
        <h1>Ehcache 3.0 Documentation</h1>
      </div>
      <div>
        <br/>

<div class="container-fluid">


  <div class="row row-offcanvas row-offcanvas-left">

    <!-- sidebar -->
    <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
        <ul class="nav">
          <li class="submenu"><a href="index.html">Docs Overview</a></li>
          <li class="submenu"><a href="getting-started.html">Getting Started</a></li>
          <li class="submenu"><a href="xml.html">XML Configuration</a></li>
          <li class="submenu"><a href="usermanaged.html">User Managed Caches</a></li>
          <li class="submenu"><a href="107.html">javax.cache aka JSR-107</a></li>
          <li class="submenu"><a href="examples.html">Java Examples</a></li>
          <li class="submenu"><a href="xsds.html">Configuration XSD</a></li>
        </ul>
    </div>

    <!-- main area -->

    <div class="col-xs-12 col-sm-9">
      <header class="post-header">
         
      </header>
      <article class="post-content">
        <h1 id="user-managed-caches" class="sect0">User managed caches</h1>
<div class="sect1">
<h2 id="what-are-user-managed-caches-and-what-do-they-offer">What are user managed caches and what do they offer?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>User managed caches is a new concept introduced in Ehcache 3.<br />
It offers the ability to create caches that are not managed by a <code>CacheManager</code>.<br />
Hence the name of <em>user managed</em> caches.</p>
</div>
<div class="paragraph">
<p>The objective of this feature is to satisfy cache use cases where the added complexity of a cache manager is of no added value.<br />
Ideas are: method local caches, thread local caches or any other place where the lifecycle of the cache is shorter than the application lifecycle.</p>
</div>
<div class="sect2">
<h3 id="limitations">Limitations</h3>
<div class="paragraph">
<p>As there is no longer a cache manager offering up services, the main limitation of user managed caches is that the user has to configure all required services by hand.<br />
Of course, if you find yourself requiring plenty of services, maybe the cache manager is a better option!</p>
</div>
</div>
<div class="sect2">
<h3 id="api-extensions">API extensions</h3>
<div class="paragraph">
<p>While a <code>UserManagedCache</code> extends <code>Cache</code>, it offers additional methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package org.ehcache;

/**
 * Represents a Cache that is not managed by a {@link org.ehcache.CacheManager}, as such that needs to
 * have {@link #close()} invoked in order to release all its resources.
 *
 * @param &lt;K&gt; the type of the keys used to access data within this cache
 * @param &lt;V&gt; the type of the values held within this cache
 *
 * @author Alex Snaps
 */
public interface UserManagedCache&lt;K, V&gt; extends Cache&lt;K, V&gt; {

  /**
   * Attempts at having this UserManagedCache go to {@link org.ehcache.Status#AVAILABLE}.
   * &lt;p&gt;
   * Should this throw, while the UserManagedCache isn't yet {@link org.ehcache.Status#AVAILABLE}, it will try to go back
   * to {@link org.ehcache.Status#UNINITIALIZED} properly.
   *
   * @throws java.lang.IllegalStateException if the UserManagedCache isn't in {@link org.ehcache.Status#UNINITIALIZED} state
   * @throws org.ehcache.exceptions.StateTransitionException if the UserManagedCache couldn't be made {@link org.ehcache.Status#AVAILABLE}
   * @throws java.lang.RuntimeException if any exception is thrown, but still results in the UserManagedCache transitioning to {@link org.ehcache.Status#AVAILABLE}
   */
  void init();

  /**
   * Releases all data held in this UserManagedCache.
   * &lt;p&gt;
   * Should this throw, while the UserManagedCache isn't yet {@link org.ehcache.Status#UNINITIALIZED}, it will keep on
   * trying to go to {@link org.ehcache.Status#UNINITIALIZED} properly.
   *
   * @throws org.ehcache.exceptions.StateTransitionException if the UserManagedCache couldn't be cleanly made
   *                                                         {@link org.ehcache.Status#UNINITIALIZED},
   *                                                         wrapping the first exception encountered
   * @throws java.lang.RuntimeException if any exception is thrown, like from Listeners
   */
  void close();

  /**
   * Returns the current {@link org.ehcache.Status} for this CacheManager
   * @return the current {@link org.ehcache.Status}
   */
  Status getStatus();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen, these methods deal with the lifecycle of the cache and need to be called explicitly.</p>
</div>
<div class="paragraph">
<p>There is also the following interface which comes into play when a user managed persistent cache is created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package org.ehcache;

/**
 * A {@link UserManagedCache} that holds data that outlives the JVM's process
 *
 * @param &lt;K&gt; the type of the keys used to access data within this cache
 * @param &lt;V&gt; the type of the values held within this cache
 *
 * @author Alex Snaps
 */
public interface PersistentUserManagedCache&lt;K, V&gt; extends UserManagedCache&lt;K, V&gt; {

  /**
   * Lets you manipulate the persistent data structures for this {@link PersistentUserManagedCache}
   *
   * @return a {@link org.ehcache.Maintainable} for this {@link PersistentUserManagedCache}
   * @throws java.lang.IllegalStateException if state {@link org.ehcache.Status#MAINTENANCE} couldn't be reached
   */
  Maintainable toMaintenance();
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started-with-user-managed-caches">Getting started with user managed caches</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="basic-example">Basic example</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">UserManagedCache&lt;Long, String&gt; userManagedCache =
    UserManagedCacheBuilder.newUserManagedCacheBuilder(Long.class, String.class)
        .build(false); <i class="conum" data-value="1"></i><b>(1)</b>
userManagedCache.init(); <i class="conum" data-value="2"></i><b>(2)</b>

userManagedCache.put(1L, "da one!"); <i class="conum" data-value="3"></i><b>(3)</b>

userManagedCache.close(); <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a <code>UserManagedCache</code> instance, again you can either have the builder <code>init()</code> it for you, passing true or</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>pass false and it is up to you to <code>UserManagedCache.init()</code> them, prior to using them.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>You can use the cache exactly as a managed cache</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>In the same vein, a <code>UserManagedCache</code> requires you to <code>UserManagedCache.close()</code> it explicitly. If you would also use<br />
managed caches simultaneously, the <code>CacheManager.close()</code> operation would not impact the user managed cache(s).</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="disk-persistent-example">Disk persistent example</h3>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">    LocalPersistenceService persistenceService = new DefaultLocalPersistenceService(new DefaultPersistenceConfiguration(new File(getStoragePath(), "myUserData"))); <i class="conum" data-value="1"></i><b>(1)</b>
//    persistenceService.start(, null);

    PersistentUserManagedCache&lt;Long, String&gt; cache = UserManagedCacheBuilder.newUserManagedCacheBuilder(Long.class, String.class)
        .with(new UserManagedPersistenceContext&lt;Long, String&gt;("cache-name", persistenceService)) <i class="conum" data-value="2"></i><b>(2)</b>
        .withResourcePools(ResourcePoolsBuilder.newResourcePoolsBuilder()
            .heap(10L, EntryUnit.ENTRIES)
            .disk(10L, MemoryUnit.MB, true)) <i class="conum" data-value="3"></i><b>(3)</b>
        .build(true);

    // Work with the cache
    cache.put(42L, "The Answer!");
    assertThat(cache.get(42L), is("The Answer!"));

    cache.close(); <i class="conum" data-value="4"></i><b>(4)</b>
    cache.toMaintenance().destroy(); <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create the persistence service to be used by the cache for storing data on disk</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Pass the persistence service to the builder next to an id for the cache - note that this will make the builder produce a more specific type: <code>PersistentUserManagedCache</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>As usual, indicate here if the data should outlive the cache</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Closing the cache will not delete the data it saved on disk when marked as persistent.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>To delete the data, the cache need to be put in maintenance mode and destroy has to be explicitly invoked.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
      </article>
    </div>

  </div>

</div>

      </div>
    </div>

    <br/>
<footer class="site-footer">

  <div class="container">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        Related Projects:<br/>
        <a href="http://www.terracotta.org"><img src="/images/Terracotta_Logo_sm.png" style="max-height: 16px;"></a><br/><br/>
        <a href="http://www.quartz-scheduler.org"><img src="/images/logo-quartz-scheduler.png" style="max-height: 20px;"></a>

        <!--
        <ul class="contact-list">
          <li>Ehcache</li>
          <li><a href="mailto:tc-oss@softwareag.com">tc-oss@softwareag.com</a></li>
        </ul>
      -->
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/ehcache">
              <i class="fa fa-github"></i> GitHub
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/ehcache">
              <i class="fa fa-twitter"></i> Twitter
            </a>
          </li>
          

          
          <li>
            <a href="http://www.facebook.com/Terracotta">
              <i class="fa fa-facebook"></i> Facebook
            </a>
          </li>
          

          
          <li>
            <a href="http://www.linkedin.com/company/terracotta">
              <i class="fa fa-linkedin"></i> LinkedIn
            </a>
          </li>
          
        </ul>
      </div>

    <div class="footer-col  footer-col-3">
      <a href="/downloads/"><i class="fa fa-download"></i> Download Now</a>
      <br/>
      <a href="/documentation/"><i class="fa fa-book"></i> Documentation</a>
      <br/>
      <a href="/community/"><i class="fa fa-users"></i> Join the Community</a>
    </div>

    </div>

    <div class="container-fluid">
        <hr/>
        <em class="copyleft">Ehcache is Open Source and freely available under the Apache 2 License</em>
        <br/>
        <em class="copyright">&copy; Terracotta, Inc., a wholly-owned subsidiary of Software AG USA, Inc. All rights reserved.</em>
    </div>
  </div>

</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="https://maxcdn.bootstrapcdn.com/js/ie10-viewport-bug-workaround.js"></script>

<!--  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/2.1.0/jquery.scrollTo.min.js"/> -->

<script type="text/javascript">
        $('#ehc_mnu_docs').addClass("active");
        $('#').addClass("active");
</script>


  </body>

</html>
